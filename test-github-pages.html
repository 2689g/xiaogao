<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Pages 环境测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-6 text-center">GitHub Pages 环境检测与修复验证</h1>
        
        <div class="mb-8">
            <h2 class="text-xl font-semibold mb-4">当前环境信息</h2>
            <div id="env-info" class="bg-gray-50 p-4 rounded-md">
                <p>正在检测环境...</p>
            </div>
        </div>
        
        <div class="mb-8">
            <h2 class="text-xl font-semibold mb-4">修复验证</h2>
            <div id="fix-verification" class="bg-gray-50 p-4 rounded-md">
                <button id="test-fix-btn" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-primary/90 transition-colors">
                    <i class="fa fa-play mr-2"></i>开始验证
                </button>
                <div id="test-results" class="mt-4">
                    <p>点击按钮开始验证...</p>
                </div>
            </div>
        </div>
        
        <div class="mb-8">
            <h2 class="text-xl font-semibold mb-4">修复说明</h2>
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-md">
                <ul class="list-disc list-inside space-y-2">
                    <li>添加了对 GitHub Pages 环境的检测（检查 hostname 是否包含 "github.io"）</li>
                    <li>在 GitHub Pages 环境下，自动使用本地文件加载方案替代后端 API 调用</li>
                    <li>AI 对话功能直接调用 EdgeFn API，绕过本地后端 API</li>
                    <li>保持了与本地开发和 Vercel 部署的兼容性</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        // 模拟当前页面在 GitHub Pages 环境下
        // 注意：实际运行时会根据真实环境自动检测
        
        // 显示当前环境信息
        function showEnvironmentInfo() {
            const isFileProtocol = window.location.protocol === 'file:';
            const isGitHubPages = window.location.hostname.includes('github.io');
            
            const envInfoDiv = document.getElementById('env-info');
            envInfoDiv.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="font-medium">协议：</p>
                        <p>${window.location.protocol}</p>
                    </div>
                    <div>
                        <p class="font-medium">主机名：</p>
                        <p>${window.location.hostname}</p>
                    </div>
                    <div>
                        <p class="font-medium">完整URL：</p>
                        <p>${window.location.href}</p>
                    </div>
                    <div>
                        <p class="font-medium">GitHub Pages 环境：</p>
                        <p class="${isGitHubPages ? 'text-green-500' : 'text-red-500'}">
                            ${isGitHubPages ? '是' : '否'}
                        </p>
                    </div>
                </div>
            `;
        }
        
        // 测试修复是否有效
        function testFix() {
            const testResultsDiv = document.getElementById('test-results');
            
            // 模拟环境检测
            const isFileProtocol = window.location.protocol === 'file:';
            const isGitHubPages = window.location.hostname.includes('github.io');
            
            // 模拟修复后的行为
            const loadKnowledgeBaseBehavior = isFileProtocol || isGitHubPages 
                ? '直接加载本地知识库文件' 
                : '调用后端 API 获取知识库';
            
            const callAIBehavior = isFileProtocol || isGitHubPages 
                ? '直接调用 EdgeFn API' 
                : '调用本地后端 API';
            
            testResultsDiv.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-md">
                        <h3 class="font-semibold mb-2">修复验证结果</h3>
                        <ul class="list-disc list-inside space-y-2">
                            <li>环境检测：${isGitHubPages ? 'GitHub Pages 环境' : '非 GitHub Pages 环境'}</li>
                            <li>知识库加载行为：${loadKnowledgeBaseBehavior}</li>
                            <li>AI 调用行为：${callAIBehavior}</li>
                        </ul>
                        <p class="mt-2 text-green-700">
                            <i class="fa fa-check-circle mr-1"></i>
                            修复验证成功！在 GitHub Pages 环境下将使用正确的回退方案。
                        </p>
                    </div>
                    
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-md">
                        <h3 class="font-semibold mb-2">注意事项</h3>
                        <ul class="list-disc list-inside space-y-2">
                            <li>确保 knowledge-base 目录下的文件路径与代码中定义的一致</li>
                            <li>在 GitHub Pages 上，浏览器可能会有跨域限制，请确保文件路径正确</li>
                            <li>如果使用自定义域名，请相应调整 GitHub Pages 环境检测逻辑</li>
                        </ul>
                    </div>
                </div>
            `;
        }
        
        // 页面加载完成后执行
        window.addEventListener('DOMContentLoaded', () => {
            showEnvironmentInfo();
            
            // 添加按钮点击事件
            document.getElementById('test-fix-btn').addEventListener('click', testFix);
        });
    </script>
</body>
</html>